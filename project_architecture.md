# Архитектура проекта "Генератор отчетов по данным сотрудников"

## Общее описание архитектуры

Проект реализован с использованием объектно-ориентированного подхода и следует нескольким ключевым архитектурным принципам:

1. **Модульность** - проект разделен на логические модули, каждый из которых отвечает за отдельную функциональность
2. **Принцип единственной ответственности (SRP)** - каждый класс имеет только одну причину для изменения
3. **Открыт/закрыт принцип (OCP)** - классы открыты для расширения, но закрыты для модификации
4. **Инверсия зависимостей (DIP)** - зависимость от абстракций, а не от конкретных реализаций

## Структура проекта

```
├── main.py                      # Основной файл для запуска скрипта
├── README.md                    # Документация проекта
├── run_tests.py                 # Скрипт для запуска тестов
├── src/                         # Исходный код
│   ├── __init__.py
│   ├── reports/                 # Модули для генерации отчетов
│   │   ├── __init__.py
│   │   ├── formatters.py        # Форматеры для вывода отчетов
│   │   └── report_generator.py  # Классы генераторов отчетов
│   └── utils/                   # Утилиты
│       ├── __init__.py
│       └── csv_reader.py        # Класс для чтения CSV файлов
└── tests/                       # Тесты
    ├── __init__.py
    └── unit/                    # Модульные тесты
        ├── __init__.py
        ├── test_csv_reader.py   # Тесты для CSV ридера
        ├── test_formatters.py   # Тесты для форматеров
        ├── test_main.py         # Тесты для основного модуля
        └── test_report_generator.py  # Тесты для генераторов отчетов
```

## Ключевые архитектурные решения

### 1. Паттерн "Фабрика" (Factory)

В проекте используется паттерн "Фабрика" для создания экземпляров классов генераторов отчетов и форматеров:

- **ReportFactory** - фабрика для создания генераторов отчетов разных типов
- **FormatterFactory** - фабрика для создания форматеров отчетов в разных форматах

Преимущества этого подхода:
- Сокрытие деталей создания объектов
- Легкое расширение системы новыми типами отчетов и форматов
- Централизованное создание объектов

### 2. Абстрактные базовые классы

Использование абстрактных базовых классов устанавливает общий интерфейс для всех реализаций:

- **ReportGenerator** - абстрактный базовый класс для всех генераторов отчетов
- **ReportFormatter** - абстрактный базовый класс для всех форматеров отчетов

Этот подход:
- Обеспечивает полиморфизм
- Гарантирует соблюдение контракта всеми реализациями
- Упрощает тестирование

### 3. Модульность и разделение обязанностей

Проект разделен на четко определенные модули:

- **CSVReader** - отвечает только за чтение данных из CSV файлов
- **ReportGenerator** - отвечает только за генерацию отчетов
- **ReportFormatter** - отвечает только за форматирование данных отчета

Преимущества:
- Каждый модуль можно развивать и тестировать независимо
- Легкая замена или модификация отдельных компонентов
- Повышение читаемости и поддерживаемости кода

### 4. Расширяемость

Архитектура проекта обеспечивает легкое расширение функциональности:

- Для добавления нового типа отчета достаточно создать новый класс-наследник от ReportGenerator и зарегистрировать его в фабрике
- Для добавления нового формата вывода достаточно создать новый класс-наследник от ReportFormatter и зарегистрировать его в фабрике

Это позволяет добавлять новые возможности без изменения существующего кода.

### 5. Обработка ошибок

В проекте реализован комплексный подход к обработке ошибок:

- Проверка входных данных и аргументов командной строки
- Обработка ошибок при чтении файлов
- Проверка корректности данных
- Информативные сообщения об ошибках

Это повышает надежность и удобство использования программы.

### 6. Тестируемость

Архитектура проекта позволяет легко тестировать все компоненты в изоляции:

- Модульные тесты для каждого компонента
- Фикстуры для тестовых данных
- Высокое покрытие кода тестами

## Алгоритм работы программы

1. **Разбор аргументов командной строки**:
   - Валидация путей к файлам
   - Проверка корректности типа отчета и формата вывода

2. **Чтение данных из CSV файлов**:
   - Проверка существования файлов
   - Парсинг данных из файлов
   - Объединение данных из разных файлов

3. **Генерация отчета**:
   - Получение генератора отчетов для заданного типа
   - Обработка данных сотрудников и расчет необходимых показателей
   - Формирование структуры данных отчета

4. **Форматирование отчета**:
   - Получение форматера для заданного формата вывода
   - Преобразование данных отчета в нужный формат (текст или JSON)

5. **Вывод или сохранение результата**:
   - Вывод отчета в консоль или сохранение в файл
   - Проверка успешности операции сохранения

## Конкретные примеры использования паттернов

### Пример использования паттерна "Фабрика"

```python
# В main.py
report_generator = ReportFactory.get_generator(args.report)
formatter = FormatterFactory.get_formatter(args.format)

# В report_generator.py
class ReportFactory:
    _generators: Dict[str, Type[ReportGenerator]] = {
        'payout': PayoutReportGenerator,
    }
    
    @classmethod
    def get_generator(cls, report_type: str) -> Optional[ReportGenerator]:
        generator_class = cls._generators.get(report_type)
        if generator_class:
            return generator_class()
        return None
```

### Пример использования абстрактных базовых классов

```python
# В formatters.py
class ReportFormatter(ABC):
    @abstractmethod
    def format(self, data: Dict[str, Any]) -> str:
        pass

class TextFormatter(ReportFormatter):
    def format(self, data: Dict[str, Any]) -> str:
        # Реализация форматирования в текст
        return formatted_text
```

## Расширение проекта в будущем

Благодаря выбранной архитектуре, проект можно легко расширять:

1. **Новые типы отчетов**: например, отчеты по средней ставке в отделе, отчеты по эффективности и т.д.

2. **Новые форматы вывода**: например, XML, CSV, HTML или PDF

3. **Дополнительные источники данных**: добавление поддержки других форматов файлов или баз данных

4. **Улучшения интерфейса**: добавление веб-интерфейса или GUI

5. **Расширение функциональности отчетов**: добавление графиков, статистического анализа и т.д.

## Заключение

Архитектура проекта основана на принципах объектно-ориентированного программирования и ключевых паттернах проектирования. Благодаря модульности, абстракции и использованию паттерна "Фабрика", система обладает высокой расширяемостью и поддерживаемостью. Тщательная обработка ошибок и комплексное тестирование обеспечивают надежность работы программы. 